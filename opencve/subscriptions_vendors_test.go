package opencve

import (
	"context"
	"net/http"
	"testing"

	"github.com/jarcoal/httpmock"
	"github.com/stretchr/testify/assert"
)

func TestSubscribedVendorsList(t *testing.T) {
	ctx := context.Background()

	resp := `[
		{
			"name": "cisco",
			"human_name": "Cisco"
		},
		{
			"name": "debian",
			"human_name": "Debian"
		},
		{
			"name": "python",
			"human_name": "Python"
		}
	]`

	httpmock.RegisterResponder("GET", "https://www.opencve.io/api/account/subscriptions/vendors",
		httpmock.NewStringResponder(http.StatusOK, resp))

	api, err := New("user", "pass", nil)
	assert.Nil(t, err)

	l, err := api.SubscriptionsVendors().List(ctx)
	assert.Nil(t, err)
	assert.Len(t, *l, 3)
	assert.Equal(t, "debian", (*l)[1].Name)
}
