package opencve

import (
	"context"
	"net/http"
	"testing"

	"github.com/jarcoal/httpmock"
	"github.com/stretchr/testify/assert"
)

func TestSubscribedProductsList(t *testing.T) {
	ctx := context.Background()

	resp := `[
		{
			"name": "application_security_manager_appliance",
			"human_name": "Application Security Manager Appliance",
			"parent_vendor": "f5"
		}, {
			"name": "mac_os_x",
			"human_name": "Mac Os X",
			"parent_vendor": "apple"
		},
		{
			"name": "wordpress",
			"human_name": "Wordpress",
			"parent_vendor": "wordpress"
		}
	]`

	httpmock.RegisterResponder("GET", "https://www.opencve.io/api/account/subscriptions/products",
		httpmock.NewStringResponder(http.StatusOK, resp))

	api, err := New("user", "pass", nil)
	assert.Nil(t, err)

	l, err := api.SubscriptionsProducts().List(ctx)
	assert.Nil(t, err)
	assert.Len(t, *l, 3)
	assert.Equal(t, "mac_os_x", (*l)[1].Name)
}
