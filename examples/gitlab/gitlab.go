package main

import (
	"context"
	"fmt"
	"log"
	"os"

	"github.com/rk295/opencve-go/opencve"
)

func main() {
	username := os.Getenv(opencve.OpenCVEUsernameEnvName)
	password := os.Getenv(opencve.OpenCVEPasswordEnvName)

	ctx := context.Background()
	api, err := opencve.New(username, password, nil)
	if err != nil {
		log.Fatal(err)
	}

	page := 1
	gl := "gitlab"

	opts := &opencve.CVEListOptions{
		PageQuery: &page,
		FilterBy: &opencve.CVEFilter{
			Vendor:  &gl,
			Product: &gl,
		},
	}

	list, err := api.CVE().List(ctx, opts)
	if err != nil {
		log.Fatal(err)
	}

	fmt.Printf("Found %d CVEs for product %s by vendor %s...\n", len(*list), gl, gl)
	for _, cve := range *list {
		fmt.Printf("%s - %s\n", cve.ID, cve.Summary)
	}

}
