package main

import (
	"context"
	"fmt"
	"log"
	"os"

	"github.com/rk295/opencve-go/opencve"
)

func main() {
	username := os.Getenv(opencve.OpenCVEUsernameEnvName)
	password := os.Getenv(opencve.OpenCVEPasswordEnvName)

	ctx := context.Background()
	api, err := opencve.New(username, password, nil)
	if err != nil {
		log.Fatal(err)
	}

	api.WithRetry()

	reports, err := api.Reports().List(ctx)
	if err != nil {
		log.Fatal(err)
	}

	fmt.Printf("found %d report(s)\n", len(*reports))

	for _, r := range *reports {
		fmt.Printf("* %s\n", r.ID)

		report, err := api.Reports().Get(ctx, r.ID)
		if err != nil {
			log.Fatal(err)
		}

		for _, a := range report.Alerts {
			fmt.Printf("  * cve: %s vendors: %s\n", a.CVE, a.Details.Vendors)
		}
	}
}
